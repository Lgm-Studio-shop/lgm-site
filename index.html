<script>
// Твоє ID таблиці
const sheetId = "1-7vzk0PnrJcB88qVycN6OL1c2m1lFUs7FLlSf2tsNWQ";
const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&t=${new Date().getTime()}`;

let allProducts = [];

async function fetchData() {
    try {
        const res = await fetch(csvUrl);
        const text = await res.text();
        
        // Розбиваємо текст на рядки і прибираємо лапки, які додає Google
        const rows = text.split("\n").slice(1);

        allProducts = rows.map(r => {
            const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return {
                name: c[0] ? c[0].replace(/^"|"$/g, '') : '',
                price: c[1] ? c[1].replace(/^"|"$/g, '') : '',
                image: c[2] ? c[2].replace(/^"|"$/g, '').trim() : '',
                category: c[3] ? c[3].replace(/^"|"$/g, '').trim().toLowerCase() : ''
            };
        }).filter(p => p.name && p.image); // Показуємо тільки якщо є ім'я і картинка

        renderProducts(allProducts);
    } catch (e) {
        console.error("Помилка:", e);
        document.getElementById("product-container").innerHTML = '<div class="loader">Помилка завантаження даних.</div>';
    }
}

function renderProducts(list) {
    const container = document.getElementById("product-container");
    if (!list.length) {
        container.innerHTML = '<div class="loader">Товарів не знайдено</div>';
        return;
    }
    container.innerHTML = list.map(p => `
        <div class="card" onclick="alert('Для замовлення пишіть в Direct')">
            <img src="${p.image}" alt="${p.name}">
            <div class="product-name">${p.name}</div>
            <div class="product-price">${p.price}</div>
        </div>
    `).join("");
}

function filterData(cat) {
    document.querySelectorAll(".filter-btn").forEach(b => {
        b.classList.remove("active");
        if(b.innerText.toLowerCase() === cat) b.classList.add("active");
    });
    if (cat === 'all') renderProducts(allProducts);
    else renderProducts(allProducts.filter(p => p.category === cat));
}

fetchData();
</script>
